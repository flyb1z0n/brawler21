# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Unity 6 (6000.3.8f1) 2D local two-player physics brawler prototype, deployed as a WebGL game on GitHub Pages via GitHub Actions.

## Common Commands

All builds and testing go through the Unity Editor or CI — there are no shell-level build scripts.

| Task | How |
|---|---|
| Setup/rebuild scene | Unity Editor: `Brawler > Setup Game Scene` |
| Play-test | Open `Assets/Scenes/GameScene.unity`, press Play in Editor |
| Unity CLI build | `Unity.exe -batchmode -projectPath . -executeMethod CIBuild.WebGL -quit` |
| Run tests | Unity Editor: `Window > General > Test Runner` |
| CI build + deploy | Push to `main` — GitHub Actions builds WebGL and deploys to `gh-pages` |

CI requires GitHub secrets: `UNITY_LICENSE`, `UNITY_EMAIL`, `UNITY_PASSWORD`.

## Architecture

Single scene (`Assets/Scenes/GameScene.unity`), flat `MonoBehaviour`-per-concern design. Scene layout is procedurally generated by `Assets/Editor/SetupScene.cs` (safe to re-run — clears and rebuilds everything).

### Per-Player Components

Each player GameObject stacks these scripts:

- **`PlayerMovement`** — horizontal movement + jump; ground detection via `OnCollisionStay2D`/`OnCollisionExit2D` with `"Ground"` tag
- **`PlayerCombat`** — melee punch with `Physics2D.OverlapCircleAll`; deals 15 HP + knockback
- **`PlayerShooting`** — tracks `facingDirection` from velocity; manages gun child object rotation/position
- **`PlayerHealth`** — 100 HP, floating `TextMesh` label in `LateUpdate`; triggers respawn at 0 HP
- **`PlayerRespawn`** — resets position and health

### Supporting Actors

- **`Bullet`** — projectile with runtime-generated 4×4 orange sprite; 25 HP damage + knockback; self-destructs after 3 s or on hit
- **`GunPickup`** — world item that attaches to player on trigger overlap; dropped with random horizontal impulse
- **`DeathZone`** — trigger at y = −7; calls `PlayerRespawn.Respawn()` on any `"Player"` tag

### Player Controls (hardcoded in SetupScene.cs)

| Action | Player 1 | Player 2 |
|---|---|---|
| Move | A / D | Left / Right Arrow |
| Jump | W | Up Arrow |
| Punch | S | Down Arrow |
| Shoot | Left Shift | Right Control |

Note: `com.unity.inputsystem` is present in the manifest but gameplay uses legacy `Input.GetKey`.

## Key Files

- `Assets/Editor/SetupScene.cs` — full scene scaffolding; creates tags, prefabs, GameObjects, registers scene in build settings
- `Assets/Editor/CIBuild.cs` — CI entry point; disables WebGL gzip compression so GitHub Pages can serve without `Content-Encoding` headers; outputs to `build/WebGL/brawler21`
- `.github/workflows/build-and-deploy.yml` — build (GameCI `unity-builder@v4`) + deploy (`github-pages-deploy-action@v4`); caches `Library/` on `Assets/**`, `Packages/**`, `ProjectSettings/**` hashes
- `.github/workflows/activation.yml` — manual-only one-time workflow to generate Unity license `.alf` file

## Unity Version

`6000.3.8f1` — specified in `ProjectSettings/ProjectVersion.txt` and in the CI workflow.
